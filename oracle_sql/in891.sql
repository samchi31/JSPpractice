
UPDATE MEMBER set mem_pass='asdfasdf', mem_name='김은대', mem_regno1='000315', mem_regno2='3406420', mem_bir=to_date('2000/03/15','YYYY/MM/DD'),mem_zip='135-972',mem_add1='대전시 동구 용운동',mem_add2='222-2번지',mem_hometel='042-621-4615',mem_comtel='042-621-4615',mem_hp='010-6217-4615',mem_mail='pyoedab@lycos.co.kr',mem_job='주부',mem_like='수영',mem_memorial='결혼기념일',mem_memorialday=null,mem_mileage=1000,mem_delete=null       where mem_id = 'a001'          ;
UPDATE MEMBER set mem_pass='1004',mem_name='이쁜이',mem_regno1='981204', mem_regno2='2900000',mem_bir=to_date('1998/12/04','YYYY/MM/DD'),mem_zip='700-030',mem_add1='서울시 천사동 예쁜마을',mem_add2='1004-29',mem_hometel='02-888-9999',mem_comtel='02-888-9999',mem_hp='010-8886-9999',mem_mail='engelcd@pretty.net',mem_job='회사원',mem_like='수영',mem_memorial='아버님생신',mem_memorialday=null,mem_mileage=2300,mem_delete=null                   where mem_id = 'b001'          ;
UPDATE MEMBER set mem_pass='7777',mem_name='신용환',mem_regno1='980324', mem_regno2='1400716',mem_bir=to_date('1998/03/24','YYYY/MM/DD'),mem_zip='407-817',mem_add1='대전광역시 중구 대흥동',mem_add2='477-9',mem_hometel='042-123-5678',mem_comtel='042-123-5678',mem_hp='010-1236-5678',mem_mail='kyh01e@hanmail.net',mem_job='교사',mem_like='독서',mem_memorial='아내생일',mem_memorialday=null,mem_mileage=3500,mem_delete=null                      where mem_id = 'c001'          ;
UPDATE MEMBER set mem_pass='123joy',mem_name='성윤미',mem_regno1='700609', mem_regno2='2000000',mem_bir=to_date('1970/06/09','YYYY/MM/DD'),mem_zip='501-705',mem_add1='대전시 중구 하늘동 ',mem_add2='땅 3번지',mem_hometel='042-222-8877',mem_comtel='042-222-8877',mem_hp='010-2228-8877',mem_mail='dbs81f@hanmail.net',mem_job='공무원',mem_like='볼링',mem_memorial='결혼기념일',mem_memorialday=null,mem_mileage=1700,mem_delete=null                 where mem_id = 'd001'          ;
UPDATE MEMBER set mem_pass='00000000',mem_name='이혜나',mem_regno1='990701', mem_regno2='2406017',mem_bir=to_date('1999/07/01','YYYY/MM/DD'),mem_zip='617-800',mem_add1='대전시 대덕구 읍내동',mem_add2='혜강아파트',mem_hometel='042-432-8901',mem_comtel='042-432-8901',mem_hp='010-4329-8901',mem_mail='bosiang@hanmail.net',mem_job='농업',mem_like='당구',mem_memorial='아버님생신',mem_memorialday=null,mem_mileage=6500,mem_delete=null             where mem_id = 'e001'          ;
UPDATE MEMBER set mem_pass='12345678',mem_name='신영남',mem_regno1='000228', mem_regno2='3459919',mem_bir=to_date('2000/02/28','YYYY/MM/DD'),mem_zip='140-706',mem_add1='대전광역시 대흥동',mem_add2='65-33 303호',mem_hometel='042-253-2121',mem_comtel='042-253-2121',mem_hp='010-2538-2121',mem_mail='SUPER-KHG@HANMAIL.NET',mem_job='주부',mem_like='볼링',mem_memorial='아내생일',mem_memorialday=null,mem_mileage=2700,mem_delete=null               where mem_id = 'f001'          ;
UPDATE MEMBER set mem_pass='1456',mem_name='송경희',mem_regno1='020111', mem_regno2='4403414',mem_bir=to_date('2002/01/11','YYYY/MM/DD'),mem_zip='339-841',mem_add1='충남금산군 제원면',mem_add2='심내리123-1',mem_hometel='0412-356-3578',mem_comtel='0412-356-3578',mem_hp='010-3565-3578',mem_mail='lim052@hanmail.net',mem_job='주부',mem_like='스키',mem_memorial='결혼기념일',mem_memorialday=null,mem_mileage=800,mem_delete=null                   where mem_id = 'g001'          ;
UPDATE MEMBER set mem_pass='9999',mem_name='라준호',mem_regno1='980928', mem_regno2='1455822',mem_bir=to_date('1998/09/28','YYYY/MM/DD'),mem_zip='339-841',mem_add1='충남 논산시 양촌면',mem_add2='산직3구 345',mem_hometel='042-522-1679',mem_comtel='042-522-1679',mem_hp='010-5229-1679',mem_mail='wingl7@hanmail.net',mem_job='회사원',mem_like='독서',mem_memorial='아내생일',mem_memorialday=null,mem_mileage=1500,mem_delete=null                   where mem_id = 'h001'          ;
UPDATE MEMBER set mem_pass='1111',mem_name='최지현',mem_regno1='990220', mem_regno2='2384719',mem_bir=to_date('1999/02/20','YYYY/MM/DD'),mem_zip='306-702',mem_add1='대전시 동구 가양1동',mem_add2='768-12',mem_hometel='042-614-6914',mem_comtel='042-614-6914',mem_hp='010-6145-6914',mem_mail='pan@orgio.net',mem_job='공무원',mem_like='등산',mem_memorial='남편생일',mem_memorialday=null,mem_mileage=900,mem_delete=null                             where mem_id = 'i001'          ;
UPDATE MEMBER set mem_pass='6262',mem_name='김윤희',mem_regno1='991219', mem_regno2='2448920',mem_bir=to_date('1999/12/19','YYYY/MM/DD'),mem_zip='306-702',mem_add1='대전시 서구 삼천동',mem_add2='한신아파트305동309호',mem_hometel='042-332-8976',mem_comtel='042-332-8976',mem_hp='010-3321-8976',mem_mail='maxsys@hanmail.net',mem_job='농업',mem_like='개그',mem_memorial='결혼기념일',mem_memorialday=null,mem_mileage=1100,mem_delete=null         where mem_id = 'j001'          ;
UPDATE MEMBER set mem_pass='7227',mem_name='오철희',mem_regno1='860323', mem_regno2='1449311',mem_bir=to_date('1986/03/23','YYYY/MM/DD'),mem_zip='306-702',mem_add1='대전시 대덕구 대화동',mem_add2='34-567',mem_hometel='042-157-8765',mem_comtel='042-157-8765',mem_hp='010-1572-8765',mem_mail='equus@orgio.net',mem_job='자영업',mem_like='서예',mem_memorial='아내생일',mem_memorialday=null,mem_mileage=3700,mem_delete=null                         where mem_id = 'k001'          ;
UPDATE MEMBER set mem_pass='12345678',mem_name='구길동',mem_regno1='030214', mem_regno2='3234566',mem_bir=to_date('2003/02/14','YYYY/MM/DD'),mem_zip='339-841',mem_add1='충남금산군 금산읍',mem_add2=' 하리35-322',mem_hometel='0412-322-8865',mem_comtel='0412-322-8865',mem_hp='010-3223-8865',mem_mail='email815@hanmail.co.kr',mem_job='자영업',mem_like='바둑',mem_memorial='결혼기념일',mem_memorialday=null,mem_mileage=5300,mem_delete=null        where mem_id = 'l001'          ;
UPDATE MEMBER set mem_pass='pass',mem_name='박지은',mem_regno1='990515', mem_regno2='2555555',mem_bir=to_date('1999/05/15','YYYY/MM/DD'),mem_zip='306-702',mem_add1='대전광역시 서구 갈마동',mem_add2='인성아파트 234동 907호',mem_hometel='042-252-0675',mem_comtel='042-252-0675',mem_hp='010-2521-0675',mem_mail='happy@hanmail.net',mem_job='은행원',mem_like='등산',mem_memorial='아버님생신',mem_memorialday=null,mem_mileage=1300,mem_delete=null   where mem_id = 'm001'          ;
UPDATE MEMBER set mem_pass='1111',mem_name='탁원재',mem_regno1='990523', mem_regno2='1011014',mem_bir=to_date('1999/05/23','YYYY/MM/DD'),mem_zip='306-702',mem_add1='대전시 동구 자양동',mem_add2='32-23',mem_hometel='042-632-2176',mem_comtel='042-632-2176',mem_hp='010-6322-2176',mem_mail='ping75@unitel.co.kr',mem_job='축산업',mem_like='낚시',mem_memorial='결혼기념일',mem_memorialday=null,mem_mileage=5880,mem_delete=null                      where mem_id = 'n001'          ;
UPDATE MEMBER set mem_pass='0909',mem_name='배인정',mem_regno1='021130', mem_regno2='4447619',mem_bir=to_date('2002/11/30','YYYY/MM/DD'),mem_zip='306-702',mem_add1='대전시 서구 갈마동',mem_add2='경성아파트502동1101호',mem_hometel='042-622-5971',mem_comtel='042-622-5971',mem_hp='010-6221-5971',mem_mail='tar-song@hanmail.net',mem_job='회사원',mem_like='등산',mem_memorial='어머님생신',mem_memorialday=null,mem_mileage=2600,mem_delete=null     where mem_id = 'o001'          ;
UPDATE MEMBER set mem_pass='sahra3',mem_name='오성순',mem_regno1='971005', mem_regno2='2458323',mem_bir=to_date('1997/10/05','YYYY/MM/DD'),mem_zip='306-702',mem_add1='대전유성구송강동',mem_add2='한솔아파트 703동 407호',mem_hometel='042-810-7658',mem_comtel='042-810-7658',mem_hp='010-8103-7658',mem_mail='sahra235@intz.com',mem_job='공무원',mem_like='독서',mem_memorial='남편생일',mem_memorialday=null,mem_mileage=2200,mem_delete=null         where mem_id = 'p001'          ;
UPDATE MEMBER set mem_pass='0000',mem_name='육평회',mem_regno1='961220', mem_regno2='1402722',mem_bir=to_date('1996/12/20','YYYY/MM/DD'),mem_zip='306-702',mem_add1='대구광역시 대덕구 중리동',mem_add2='678-43',mem_hometel='042-823-2359',mem_comtel='042-823-2359',mem_hp='010-8232-2359',mem_mail='kph@hanmail.net',mem_job='자영업',mem_like='만화',mem_memorial='결혼기념일',mem_memorialday=null,mem_mileage=1500,mem_delete=null                   where mem_id = 'q001'          ;
UPDATE MEMBER set mem_pass='park1005',mem_name='정은실',mem_regno1='010320', mem_regno2='4382532',mem_bir=to_date('2001/03/20','YYYY/MM/DD'),mem_zip='306-702',mem_add1='대전시 동구 용전동',mem_add2='321-25',mem_hometel='042-533-8768',mem_comtel='042-533-8768',mem_hp='010-5335-8768',mem_mail='econie@hanmail.net',mem_job='학생',mem_like='장기',mem_memorial='어머님생신',mem_memorialday=null,mem_mileage=700,mem_delete=null                     where mem_id = 'r001'          ;
UPDATE MEMBER set mem_pass='0819',mem_name='안은정',mem_regno1='011019', mem_regno2='4459927',mem_bir=to_date('2001/10/19','YYYY/MM/DD'),mem_zip='306-702',mem_add1='대구광역시 서구 탄방동',mem_add2='산호아파트 107동 802호',mem_hometel='042-222-8155',mem_comtel='042-222-8155',mem_hp='010-2228-8155',mem_mail='songej@hanmail.net',mem_job='공무원',mem_like='바둑',mem_memorial='결혼기념일',mem_memorialday=null,mem_mileage=3200,mem_delete=null  where mem_id = 's001'          ;
UPDATE MEMBER set mem_pass='0506',mem_name='성원태',mem_regno1='000706', mem_regno2='3454731',mem_bir=to_date('2000/07/06','YYYY/MM/DD'),mem_zip='306-702',mem_add1='대전광역시 중구 유천동',mem_add2='한사랑아파트 302동 504호',mem_hometel='042-272-8657',mem_comtel='042-272-8657',mem_hp='010-2725-8657',mem_mail='bob6@hanmail.net',mem_job='학생',mem_like='카레이싱',mem_memorial='결혼기념일',mem_memorialday=null,mem_mileage=2200,mem_delete=null where mem_id = 't001'          ;                    
UPDATE MEMBER set mem_pass='1000',mem_name='김성욱',mem_regno1='971210', mem_regno2='1460111',mem_bir=to_date('1997/12/10','YYYY/MM/DD'),mem_zip='306-702',mem_add1='대전시 동구 용전동',mem_add2='76-54',mem_hometel='042-273-9056',mem_comtel='042-273-9056',mem_hp='010-2734-9056',mem_mail='pss576@orgio.net',mem_job='주부',mem_like='영화감상',mem_memorial='결혼기념일',mem_memorialday=null,mem_mileage=2700,mem_delete=null                       where mem_id = 'u001'          ;
UPDATE MEMBER set mem_pass='00001111',mem_name='이진영',mem_regno1='760331', mem_regno2='2402712',mem_bir=to_date('1976/03/31','YYYY/MM/DD'),mem_zip='306-702',mem_add1='대전시 동구 용전동',mem_add2='566-39번지',mem_hometel='042-240-8766',mem_comtel='042-240-8766',mem_hp='010-2406-8766',mem_mail='gagsong@orgio.net',mem_job='자영업',mem_like='낚시',mem_memorial='남편생일',mem_memorialday=null,mem_mileage=4300,mem_delete=null                where mem_id = 'v001'          ;
UPDATE MEMBER set mem_pass='12341234',mem_name='김형모',mem_regno1='880213', mem_regno2='1111111',mem_bir=to_date('1988/02/13','YYYY/MM/DD'),mem_zip='306-702',mem_add1='대전시 대덕구 연축동',mem_add2='23-43',mem_hometel='02-345-9877',mem_comtel='02-345-9877',mem_hp='010-3452-9877',mem_mail='songone@hanmail.net',mem_job='학생',mem_like='등산',mem_memorial='결혼기념일',mem_memorialday=null,mem_mileage=2700,mem_delete=null                   where mem_id = 'w001'          ;
UPDATE MEMBER set mem_pass='0000',mem_name='진현경',mem_regno1='010519', mem_regno2='4110222',mem_bir=to_date('2001/05/19','YYYY/MM/DD'),mem_zip='306-702',mem_add1='대전광역시 동구 오정동',mem_add2='43-26',mem_hometel='042-223-8767',mem_comtel='042-223-8767',mem_hp='010-2238-8767',mem_mail='happysong@hanmail.net',mem_job='주부',mem_like='독서',mem_memorial='결혼기념일',mem_memorialday=null,mem_mileage=8700,mem_delete=null                  where mem_id = 'x001'          ;

    
--#{memId, jdbcType=VARCHAR}
select ', ' || 
        COLUMN_NAME || ' = #{' SNAKETOCAMEL(COLUMN_NAME) || ', jdbcType=' || 
    CASE
        WHEN DATA_TYPE = 'VARCHAR2' THEN 'VARCHAR'
        WHEN DATA_TYPE = 'NUMBER' THEN 'NUMERIC'
        ELSE DATA_TYPE
    END || '}'
from COLS
where TABLE_NAME='MEMBER';


--<tr>
--    <th>회원아이디</th>
--    <td>
--        <input class="form-control" type="text" name="memId" value="${member.memId}" />
--        <span class="text-danger">${errors.memId }</span>
--    </td>
--</tr>

SELECT  '<tr><th>' || COMMENTS || '</th><td>' ||
    '<input class="form-control" type="' ||
    CASE 
    WHEN DATA_TYPE='DATE' OR DATA_TYPE='NUMBER' THEN LOWER(DATA_TYPE)
    ELSE 'text'
    END || '" ' ||
    DECODE(NULLABLE, 'N', ' required ', '') || 
    'name="' || SNAKETOCAMEL(A.COLUMN_NAME) || '" value="${' ||
    LOWER(A.TABLE_NAME) || '.' || SNAKETOCAMEL(A.COLUMN_NAME) || '}" />' ||
    '<span class="text-danger">${errors.' || SNAKETOCAMEL(A.COLUMN_NAME) || 
    '}</span></td></tr>'
FROM    COLS A  LEFT OUTER JOIN  USER_COL_COMMENTS B
                ON(A.TABLE_NAME = B.TABLE_NAME AND A.COLUMN_NAME = B.COLUMN_NAME)
WHERE   A.TABLE_NAME='MEMBER' ;

-- a001 사용자의 이름, 휴대폰, 이메일과 구매기록(상품명, 분류명, 거래처명, 구매가, 판매가, 마일리지)
-- 중첩 쿼리
--from    - inline view
--select  - scala query
--where   - nested query(sub query)
with cartview as (
    select  distinct cart_member, cart_prod     -- inline view
    from    cart
), prodview as (
    select  prod.* , lprod_nm, buyer_name
    from    prod inner join lprod on (prod_lgu = lprod_gu)
                 inner join buyer on (prod_buyer = buyer_id)
), cartprod as (
    select  cart_member, prod_id, prod_name, prod_lgu, prod_buyer, prod_cost, prod_price, prod_mileage, lprod_nm, buyer_name
    from    cartview inner join prodview on (cart_prod = prod_id)
)
select  mem_name, mem_hp, mem_mail,
        prod_id, prod_name, prod_lgu, prod_buyer, prod_cost, prod_price, prod_mileage,
        lprod_nm, buyer_name
from  member left outer join cartprod on (mem_id = cart_member)   -- cart는 있을수도 없을수도                
where mem_id = 'a001';

select  mem_id, prod_name, lprod_nm, buyer_name
from     member left outer join cart on (mem_id = cart_member)
                left outer join prod on (cart_prod = prod_id)
                left outer join lprod on (prod_lgu = lprod_gu)
                left outer join buyer on (prod_buyer = buyer_id)
where mem_id = 'a001';
        
-- 사용자들의 (이름과 휴대폰 이메일, 구매건수)
with cartview as (
    select  count(distinct cart_prod) as cnt, cart_member
    from    cart
    group by cart_member
)
select  mem_id, mem_hp, mem_mail, nvl(cnt, 0)
from    member left outer join cartview on ( mem_id = cart_member);

-- scala query -- record 1개 , column 1개일때만
select  mem_id, mem_hp, mem_mail
        , (
            select  count(distinct cart_prod)
            from    cart
            where   cart_member = mem_id
        )
from    member;

-- 구매기록이 있는 사용자들의 (이름과 휴대폰 이메일, 구매건수)
with cartview as (
    select  count(distinct cart_prod) as cnt, cart_member
    from    cart
    group by cart_member
)
select  mem_id, mem_hp, mem_mail, nvl(cnt, 0)
from    member left outer join cartview on ( mem_id = cart_member)
--where   cart_count is not null
where   mem_id in (             
            select  distinct cart_member
            from    cart
);

select  mem_name, mem_hp, mem_mail
from    member
where   mem_id in (
    select  distinct cart_member
    from    cart
);

SELECT  'private '||
    DECODE( DATA_TYPE , 'NUMBER', 'Integer ', 'String ') ||
    LOWER(SUBSTR(COLUMN_NAME, 1, 1)) ||
    SUBSTR( REPLACE( INITCAP(COLUMN_NAME) , '_', ''), 2) || ';'
FROM COLS
WHERE TABLE_NAME = 'BUYER';


-- * 상품 상세 조회 시 해당 거래처의 모든 정보 함께 조회함
-- * 상품 상세 조회 시 구매자 리스트 (구매자 id, 회원이름, 회원 전화번호, 이메일 ,마일리지) 함께 조회
-- * 분류명도 함께 조회

with cartmember as (
    select  distinct mem_id, mem_name, mem_hp, mem_mail, mem_mileage, cart_prod
    from    cart  inner join member on (cart_member = mem_id)
)
select  prod.*
        , (
            select  distinct lprod_nm
            from    lprod
            where   lprod_gu = prod_lgu
        )
        , cartmember.*
        , buyer.*
from    prod    left outer join cartmember on (prod_id = cart_prod)
                left outer join buyer on (prod_buyer = buyer_id)
where   prod_id = 'P101000001';

-- 정답
-- prod, buyer, lprod, cart, member
-- prod:buyer = 1:1, prod:(lprod) = 1:1, prod:(cart) = 1:n, (cart):member = 1:1, prod:member = 1:n
-- lprod와 cart 는 관계를 위한 테이블일뿐

-- 자주 사용하는 뷰 생성
--create  or replace view prodview as (
--    SELECT	PROD.*
--            , LPROD_NM
--            , BUYER.*
--    FROM	PROD INNER JOIN LPROD ON (PROD_LGU = LPROD_GU) 
--                 INNER JOIN BUYER ON (PROD_BUYER = BUYER_ID)
--);

with cartview as(
    select  cart_prod
            , mem_id, mem_name, mem_hp, mem_mail, mem_mileage
    from    cart inner join member on(cart_member = mem_id)
)
select  PROD_ID, PROD_NAME, PROD_LGU, 
        PROD_BUYER, PROD_COST, PROD_PRICE, 
        PROD_SALE, PROD_OUTLINE, PROD_DETAIL, 
        PROD_IMG, PROD_TOTALSTOCK, PROD_INSDATE, 
        PROD_PROPERSTOCK, PROD_SIZE, PROD_COLOR, 
        PROD_DELIVERY, PROD_UNIT, PROD_QTYIN, 
        PROD_QTYSALE, PROD_MILEAGE
        , lprod_nm
        , buyer_name, buyer_add1, buyer_charger
        , cartview.*
from    prodview left outer join cartview on (prod_id = cart_prod)
where   prod_id ='P101000001';

-- 또는

select  distinct prod_name
        , lprod_nm
        , buyer_name
        , cart_member
        , mem_name        
from    prod inner join lprod on (prod_lgu = lprod_gu)
             inner join buyer on (prod_buyer = buyer_id)
             left outer join cart on (prod_id = cart_prod)
             left outer join member on (cart_member = mem_id);

--comment on column member.mem_id is '회원아이디';
SELECT 'COMMENT ON COLUMN ' ||
    TABLE_NAME || '.' || COLUMN_NAME ||
    ' IS '''';'
FROM COLS
WHERE TABLE_NAME = 'PROD';
COMMENT ON COLUMN PROD.PROD_ID IS '상품아이디';
COMMENT ON COLUMN PROD.PROD_NAME IS '상품명';
COMMENT ON COLUMN PROD.PROD_LGU IS '상품분류';
COMMENT ON COLUMN PROD.PROD_BUYER IS '거래처';
COMMENT ON COLUMN PROD.PROD_COST IS '구매가';
COMMENT ON COLUMN PROD.PROD_PRICE IS '판매가';
COMMENT ON COLUMN PROD.PROD_SALE IS '세일가';
COMMENT ON COLUMN PROD.PROD_OUTLINE IS '상품요약';
COMMENT ON COLUMN PROD.PROD_DETAIL IS '상품상세';
COMMENT ON COLUMN PROD.PROD_IMG IS '상품이미지';
COMMENT ON COLUMN PROD.PROD_TOTALSTOCK IS '재고';
COMMENT ON COLUMN PROD.PROD_INSDATE IS '입고일';
COMMENT ON COLUMN PROD.PROD_PROPERSTOCK IS '적정재고';
COMMENT ON COLUMN PROD.PROD_SIZE IS '크기';
COMMENT ON COLUMN PROD.PROD_COLOR IS '색상';
COMMENT ON COLUMN PROD.PROD_DELIVERY IS '배송방법';
COMMENT ON COLUMN PROD.PROD_UNIT IS '단위';
COMMENT ON COLUMN PROD.PROD_QTYIN IS '입고량';
COMMENT ON COLUMN PROD.PROD_QTYSALE IS '출고량';
COMMENT ON COLUMN PROD.PROD_MILEAGE IS '마일리지';
--<tr>
--		<th>회원아이디</th>
--		<td>${member.memId }</td>
--	</tr>

SELECT '<tr><th>' || COMMENTS ||'</th>' ||
    '<td>${' || LOWER(TABLE_NAME) || '.' ||
    SNAKETOCAMEL(COLUMN_NAME) || '}</td></tr>'
FROM USER_COL_COMMENTS
WHERE TABLE_NAME = 'PROD';
